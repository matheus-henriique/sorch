<!doctype html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SORCH | Srteio</title>

  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="/css/main.css">

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Anton+SC&display=swap" rel="stylesheet">

  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,1,0" />

  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            white_color: '#da373d',
            emphasis: '#322745',
            font_color: '#281F38',
          },
          fontFamily: {
            anton_sc: ["Anton SC", "sans-serif"],
          }
        }
      }
    }
  </script>
</head>
<body>
    <div class="headerSorteio flex justify-center items-center flex-col mt-10">
        <div class="flex w-full max-w-xs mb-16">
          <a href="./painel.html" class="flex items-center">
            <span class="material-symbols-outlined text-start">
              arrow_back_ios
            </span>
          </a>
         
          <div class="flex justify-center flex-1 font-bold text-emphasis font-anton_sc text-6xl">SORCH</div>
        </div>
      </div>

  <div class="box flex justify-center items-center flex-col">
    
    <div class="flex flex-col w-full max-w-xs lg:max-w-full">

        <div class="w-full text-center">
            <span id="nameSorteado" class="text-2xl font-bold lg:text-6xl">Semana Jovem!!</span>
        </div>
    
        <div id="sortear" class="w-full h-11 flex justify-center items-center rounded-lg mt-56 font-bold bg-trasparent text-font_color border border-emphasis cursor-pointer lg:hidden">
            Sortear
          </div>
    </div>
  </div>
</body>

<script>
    // const nomes = [
    //     {
    //         id: 0,
    //         name: "John Doe",
    //     },
    //     {
    //         id: 2,
    //         name: "Peter Jones",
    //     },
    //     {
    //         id: 3,
    //         name: "Mary Smith",
    //     },
    //     {
    //         id: 4,
    //         name: "David Williams",
    //     },
    //     {
    //         id: 5,
    //         name: "Elizabeth Brown",
    //     },
    //     {
    //         id: 6,
    //         name: "James Miller",
    //     },
    //     {
    //         id: 7,
    //         name: "Anna Johnson",
    //     },
    //     {
    //         id: 8,
    //         name: "Robert Thompson",
    //     },
    // ];

    const url = 'https://api-sorch.onrender.com/api/persons/';

    function getAllParticipants() {
        try{
            let result = null;

            $.ajax({
                url: url,
                method: 'GET',
                dataType: 'json',
                async: false,
                success(res){
                    result = res;
                }
            });

            return result;
        } catch(error){
            console.log(error);
        }
    }

    /*
     * 
     SORTEIO
     * 
     * */
    const nomes = getAllParticipants();
    let sorteando = false;

    function atualizarNumero() {
        const indice = Math.floor(Math.random() * nomes.length);
        const nome = nomes[indice].name;
        document.getElementById("nameSorteado").innerHTML = nome;
    }

    function startSorteio() {
        if (!sorteando) {
            sorteando = true;
            intervalo = setInterval(atualizarNumero, 50);
            setTimeout(pararSorteio, 2000);
        }
    }

    function pararSorteio() {
        clearInterval(intervalo);
        sorteando = false;
    }


    /*
     * 
     FULL SCREEN 
     * 
     * */
    function toggleFullScreen() {
        if (!document.fullscreenElement) {
            enterFullScreen();
        } else {
            exitFullScreen();
        }
    }

    function enterFullScreen() {
        if (document.documentElement.requestFullscreen) {
            document.documentElement.requestFullscreen();
            hideHeaderSorteio();
        } else if (document.documentElement.webkitRequestFullscreen) {
            document.documentElement.webkitRequestFullscreen();
            hideHeaderSorteio();
        } else if (document.documentElement.mozRequestFullScreen) {
            document.documentElement.mozRequestFullScreen();
            hideHeaderSorteio();
        } else {
            alert("Seu navegador não suporta tela cheia.");
        }
    }

    function exitFullScreen() {
        if (document.exitFullscreen) {
            document.exitFullscreen();
            showHeaderSorteio();
        } else if (document.webkitExitFullscreen) {
            document.webkitExitFullscreen();
            showHeaderSorteio();
        } else if (document.mozCancelFullScreen) {
            document.mozCancelFullScreen();
            showHeaderSorteio();
        } else {
            alert("Seu navegador não suporta tela cheia.");
        }
    }


    function hideHeaderSorteio(){
        $('.headerSorteio').addClass("hidden");
    }

    function showHeaderSorteio(){
        $('.headerSorteio').removeClass("hidden");
    }

    $("#sortear").on('click', () => {
        startSorteio();
    });
    
    $(document).keydown(function(e) {
        if (e.keyCode === 32) {
            startSorteio();
        }
    });

    document.addEventListener('fullscreenchange', function() {
        if (!document.fullscreenElement) {
            exitFullScreen();
        }
    });

    $(document).on('click dblclick', function(e) {
        if (e.type === 'dblclick') {
            toggleFullScreen();
        }
    });

</script>
</html>